<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doprava na husacinu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }

    h1 {
      margin-bottom: 20px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .block {
      background: #ffffff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      min-width: 260px;
      box-sizing: border-box;
    }

    .block h2 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .block input {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-bottom: 8px;
    }

    .btn {
      padding: 10px 15px;
      background: #0077ff;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      margin-right: 10px;
    }

    .btn:hover {
      background: #005dda;
    }

    .btn.small {
      padding: 6px 10px;
      font-size: 12px;
      margin-top: 10px;
    }

    #cars {
      margin-top: 10px;
    }

    .car {
      background: #ffffff;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .car-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .seats {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .seat {
      width: 70px;
      height: 60px;
      background: #e3e3e3;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      text-align: center;
      padding: 4px;
      box-sizing: border-box;
    }

    .seat.occupied {
      background: #9ad19a;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Doprava na husacinu</h1>

  <div class="controls">
    <div class="block">
      <h2>Som vodič</h2>
      <input id="driverName" type="text" placeholder="Meno vodiča" />
      <button class="btn" id="addDriverBtn">Pridať auto</button>
    </div>

    <div class="block">
      <h2>Som pasažier</h2>
      <input id="passengerName" type="text" placeholder="Tvoje meno" />
      <p style="font-size: 12px; margin-top: 4px;">
        Zadaj svoje meno a potom nižšie klikni na <strong>Nastúpiť</strong> pri vybranom aute.
      </p>
    </div>
  </div>

  <div id="cars"></div>

  <!-- Firebase + app logika -->
  <script type="module">
    // ===== Firebase importy z CDN (oficiálny spôsob cez <script type="module">) =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      onValue,
      push,
      set
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    // ===== Sem vlož svoj Firebase config z konzoly =====
    // V Firebase console: Project settings -> Your apps -> Web -> SDK setup and configuration
    	const firebaseConfig = {
  	apiKey: "AIzaSyA-d4hjX4kLT-uweIWwXQ82CUaNl4yK4EI",
  	authDomain: "doprava-na-husacinu.firebaseapp.com",
	databaseURL: "https://doprava-na-husacinu-default-rtdb.europe-west1.firebasedatabase.app",
  	projectId: "doprava-na-husacinu",
  	storageBucket: "doprava-na-husacinu.firebasestorage.app",
  	messagingSenderId: "663942581278",
  	appId: "1:663942581278:web:d090bc39831b13093d720f",
  	measurementId: "G-HL0V9K6MEZ"
	};

    // Inicializácia Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Referencia na zoznam áut v DB
    const carsRef = ref(db, "cars");

    // Lokálny snapshot áut { id, driver, seats }
    let cars = [];

    // DOM elementy
    const carsContainer = document.getElementById("cars");
    const driverInput = document.getElementById("driverName");
    const passengerInput = document.getElementById("passengerName");
    const addDriverBtn = document.getElementById("addDriverBtn");

    // Počúvanie živých zmien z DB
    onValue(carsRef, (snapshot) => {
      const data = snapshot.val() || {};
      // Prevedieme objekt {id: car, ...} na pole
      cars = Object.entries(data).map(([id, car]) => ({
        id,
        driver: car.driver,
        seats: Array.isArray(car.seats) ? car.seats : (car.seats || [])
		note: car.note || ""
      }));
      render();
    });

    function render() {
      carsContainer.innerHTML = "";

      if (cars.length === 0) {
        carsContainer.textContent = "Zatiaľ nie sú pridané žiadne autá.";
        return;
      }

      cars.forEach((car) => {
        const div = document.createElement("div");
        div.className = "car";

        const occupiedCount = car.seats.filter((s) => s && s !== "").length;

        const header = document.createElement("div");
        header.className = "car-header";
        header.innerHTML = `
          <strong>Auto: ${car.driver}</strong>
          <span>Obsadenosť: ${occupiedCount}/5</span>
        `;
        div.appendChild(header);

        const seatsDiv = document.createElement("div");
        seatsDiv.className = "seats";

        const seats = car.seats.slice(); // kopia

        // Zabezpečíme 5 miest (ak by v DB chýbali indexy)
        while (seats.length < 5) {
          seats.push("");
        }

        seats.forEach((seat, seatIndex) => {
          const s = document.createElement("div");
          s.className = "seat" + (seat ? " occupied" : "");
          s.textContent = seat ? seat : `Miesto ${seatIndex + 1}`;
          seatsDiv.appendChild(s);
        });

        div.appendChild(seatsDiv);

		if (car.note) {
 		const noteP = document.createElement("p");
  		noteP.style.fontSize = "12px";
  		noteP.style.marginTop = "6px";
  		noteP.innerHTML = `<strong>Poznámka:</strong> ${car.note}`;
  		div.appendChild(noteP);
		}
		
        const hasFreeSeat = seats.includes("");

        const button = document.createElement("button");
        button.className = "btn small";
        button.textContent = hasFreeSeat ? "Nastúpiť" : "Plné";
        button.disabled = !hasFreeSeat;
        button.addEventListener("click", () => addPassengerToCar(car.id));
        div.appendChild(button);

        carsContainer.appendChild(div);
      });
    }

    function handleAddDriver() {
      const name = driverInput.value.trim();
      if (!name) {
        alert("Zadaj meno vodiča.");
        return;
      }

      const seats = [name, "", "", "", ""]; // vodič na 1. mieste

      // Vytvoríme nový záznam auta pod /cars
      const newCarRef = push(carsRef);
      set(newCarRef, {
        driver: name,
        seats: seats
      });

      driverInput.value = "";
    }

    function addPassengerToCar(carId) {
      const name = passengerInput.value.trim();
      if (!name) {
        alert("Zadaj svoje meno ako pasažier.");
        return;
      }

      const car = cars.find((c) => c.id === carId);
      if (!car) {
        alert("Auto sa nenašlo (pravdepodobne bolo odstránené).");
        return;
      }

      const seats = car.seats.slice();
      while (seats.length < 5) {
        seats.push("");
      }

      const idx = seats.findIndex((s) => !s);
      if (idx === -1) {
        alert("Toto auto je už plné.");
        return;
      }

      seats[idx] = name;

      // Zapíšeme späť do DB len sedadlá daného auta
      const carSeatsRef = ref(db, `cars/${carId}/seats`);
      set(carSeatsRef, seats);

      passengerInput.value = "";
    }

    // Event listener na tlačidlo vodiča
    addDriverBtn.addEventListener("click", handleAddDriver);
  </script>
</body>
</html>





